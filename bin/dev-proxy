#!/usr/bin/zsh

PORTS=(3000 5173)

TUNNELS=""
for port in "${PORTS[@]}"; do
  TUNNELS="$TUNNELS -L $port:localhost:$port"
done

start() {
  echo "Starting SSH port forwarding to $DESKTOP..."
  ssh -N $TUNNELS "akisarou@$DESKTOP" &
  echo $! >/tmp/ssh-proxy.pid
  echo "SSH tunnel started (PID $(cat /tmp/ssh-proxy.pid))"
}

stop() {
  if [[ -f /tmp/ssh-proxy.pid ]]; then
    kill "$(cat /tmp/ssh-proxy.pid)" 2>/dev/null
    rm /tmp/ssh-proxy.pid
    echo "SSH tunnel stopped"
  else
    echo "No running SSH tunnel found"
  fi
}

case "$1" in
start) start ;;
stop) stop ;;
restart)
  stop
  start
  ;;
*) echo "Usage: $0 {start|stop|restart}" ;;
esac
